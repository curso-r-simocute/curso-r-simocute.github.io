---
title: "Graficación en R"
output: 
  distill::distill_article:
    toc: true
    toc_depth: 4
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Recursos de interés
* Sitio oficial de graphics: [The R Graphics Package](http://search.r-project.org/R/library/graphics/html/graphics-package.html).
* Sitio oficial de ggplot2: [Create Elegant Data Visualisations Using the Grammar of Graphics - ggplot2](https://ggplot2.tidyverse.org/).
* Sitio oficial de plotly: [Plotly: The front end for ML and data science models](https://plotly.com/)
* Sitio oficial de dplyr: [A Grammar of Data Manipulation - dplyr](https://dplyr.tidyverse.org/).

* Libro [_R Graphics Cookbook_, de Winston Chang](https://r-graphics.org/).
* Libro [_The Grammar of Graphics_, de Leland Wilkinson et al.](https://www.springer.com/gp/book/9780387245447).
* Sitio web sobre visualización de datos: [From data to Viz | Find the graphic you need](https://www.data-to-viz.com/).

* Datos utilizados durante el curso: [Procesamiento de datos con R - datos](https://github.com/curso-r-simocute/datos).

# Trabajo previo
Se recomienda leer el [capítulo 2 del libro _R Graphics Cookbook_, de Winston Chang](https://r-graphics.org/chapter-quick).

# Conjuntos de datos utilizados
En los siguientes ejemplos y ejercicios, se utilizarán dos conjuntos de datos, los cuales se cargan en data frames con la función [read.csv()](https://www.rdocumentation.org/packages/iotools/versions/0.3-1/topics/read.csv.raw) y se visualizan con la función [View()](https://www.rdocumentation.org/packages/utils/versions/3.6.2/topics/View).

**Casos de COVID-19 en Costa Rica**  
Este conjunto de datos publicados por el [Ministerio de Salud de Costa Rica](http://geovision.uned.ac.cr/oges/) es un ejemplo de una [serie temporal](https://en.wikipedia.org/wiki/Time_series): una sucesión de datos medidos en determinados momentos y ordenados cronológicamente. Contiene un registro por día con las estadísticas de casos positivos, fallecidos, activos y recuperados.

```{r}
# Carga de datos desde un archivo CSV
cr_covid19 <- 
  read.csv(
    file='https://raw.githubusercontent.com/curso-r-simocute/datos/main/covid/04_09_21_CSV_GENERAL.csv', 
    sep = ";"
  )
```

```{r eval=FALSE}
# Despliegue de los datos
View(cr_covid19)
```

**Casos de COVID-19 en Centroamérica y República Dominicana**  
Este conjunto de datos publicados por el [Centro de Coordinación para la Prevención de los Desastres en Centroamérica y República Dominicana (Cepredenac)](http://www.cepredenac.org/) tiene un registro por país con los casos (positivos, fallecidos, activos, recuperados) acumulados hasta la fecha en cada uno.

```{r collapse=TRUE}
# Carga de datos desde un archivo CSV
ca_covid19 <- 
  read.csv(
    file='https://raw.githubusercontent.com/curso-r-simocute/datos/main/covid/covid-card.csv'
  )
```

```{r collapse=TRUE, eval=FALSE}
# Despliegue de los datos
View(ca_covid19)
```

# Paquetes de R para graficación
R provee varios paquetes para generar gráficos. Aquí se estudiarán tres:  

* [graphics](http://search.r-project.org/R/library/graphics/html/graphics-package.html): es un paquete para gráficos relativamente sencillos y forma parte de la instalación base de R.
* [ggplot2](https://ggplot2.tidyverse.org/): es parte de [Tidyverse](https://www.tidyverse.org/), una colección de paquetes de R diseñada para utilizarse en [ciencia de datos](https://en.wikipedia.org/wiki/Data_science). Este paquete está basado en el libro [_The Grammar of Graphics_, de Leland Wilkinson et al.](https://www.springer.com/gp/book/9780387245447).
* [plotly](https://plotly.com/): biblioteca de graficación disponible para JavaScript, Python, R y Julia.

## Instalación, carga y ayuda
En R, los paquetes pueden instarlarse con la función [install.packages()](https://www.rdocumentation.org/packages/utils/versions/3.6.2/topics/install.packages):

```{r eval = FALSE}
# Instalación de ggplot2
install.packages("ggplot2")

# Instalación de plotly
install.packages("plotly")

# Instalación de dplyr
# (paquete para manipulación de datos de Tidyverse)
install.packages("dplyr")

# Opcionalmente, pueden instalarse todos los paquetes de Tidyverse
install.packages("tidyverse")
```

Después de la instalación, los paquetes deben cargarse con la función [library()](https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/library):

```{r message = FALSE}
# Carga de graphics
library(graphics)

# Carga de ggplot2
library(ggplot2)

# Carga de plotly
library(plotly)

# Carga de dplyr
library(dplyr)

# Opcionalmente, puede cargarse toda la colección tidyverse
library(tidyverse)
```

Para obtener información sobre un paquete, puede utilizarse el parámetro ```help``` de ```library()```:

```{r eval = FALSE}
# Ayuda en línea sobre ggplot2
library(help="ggplot2")
```

# Tipos de gráficos

## Gráficos de dispersión
Un [diagrama o gráfico de dispersión (_scatter plot_)](https://www.data-to-viz.com/graph/scatter.html) muestra la relación entre dos variables numéricas. Para cada punto de datos, el valor de la primera variable se representa en el eje X y el de la segunda variable en el eje Y.

La función [plot()](https://www.rdocumentation.org/packages/graphics/versions/3.6.2/topics/plot) del paquete graphics recibe como argumentos los vectores de las variables que se desean graficar. El siguiente ejemplo usa las variables de casos positivos y casos activos de Covid-19 en Costa Rica.

```{r}
# Gráfico
plot(cr_covid19$positivos, cr_covid19$activos)
```

Para mejorar el gráfico, pueden utilizarse otras opciones de la función ```plot()```:

```{r}
# Gráfico con parámetros adicionales de plot()
plot(
  cr_covid19$positivos, 
  cr_covid19$activos,
  main='Relación entre casos positivos y activos de COVID-19 en CR',
  xlab='Casos positivos',
  ylab='Casos activos'
)
```

Para incluir la incluir la columna con la fecha, esta debe convertirse primero a la clase ```Date```:

```{r}
# Conversión de la columna de fecha a la clase Date
cr_covid19$FECHA <- as.Date(cr_covid19$FECHA, "%d/%m/%Y")

# Gráfico con fechas
plot(
  cr_covid19$FECHA, 
  cr_covid19$positivos,
  main='Evolución en el tiempo de los casos positivos de COVID-19 en CR',
  xlab='Fecha',
  ylab='Casos positivos'
)
```

Con la función [ggplot()](https://ggplot2.tidyverse.org/reference/ggplot.html), del paquete ggplot2, puede obtenerse un resultado similar:

```{r warning=FALSE}
# Gráfico con fechas
ggplot(cr_covid19, aes(x = FECHA, y = positivos)) +
  ggtitle('Evolución en el tiempo de los casos positivos de COVID-19 en CR') +
  xlab('Fecha') +
  ylab('Casos positivos') +
  geom_point()
```

La manera usual de usar ```ggplot()``` es con un data frame como argumento, especificando cuales columnas usar como valores de x e y. La primera parte, ```ggplot()```, crea la base del gráfico (i.e. el canvas), mientras que [geom_point()](https://ggplot2.tidyverse.org/reference/geom_point.html) agrega una capa adicional, lo mismo que [ggtitle()](https://ggplot2.tidyverse.org/reference/labs.html) y las funciones restantes.